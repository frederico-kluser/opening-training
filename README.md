# Chess Training System - Sistema Completo de Treinamento de Xadrez

## üéØ Vis√£o Geral do Projeto

Sistema de treinamento de xadrez com duas vertentes principais: **treino de aberturas personalizadas** e **an√°lise de erros com gera√ß√£o autom√°tica de puzzles** baseados em partidas reais.

### Funcionalidades Principais:

**1. Sistema de Repert√≥rio de Aberturas** ‚úÖ
- Cadastro completo de aberturas e variantes
- Anota√ß√µes personalizadas por posi√ß√£o
- Sistema de navega√ß√£o em √°rvore/grafo
- Import/Export de repert√≥rios em JSON

**2. An√°lise de Partidas com Stockfish** üöÄ (Nova Feature)
- Parser de PGN integrado
- An√°lise lance a lance com Stockfish 17
- Detec√ß√£o autom√°tica de blunders/mistakes/inaccuracies
- C√°lculo de ACPL (Average Centipawn Loss)
- Classifica√ß√£o de movimentos (brilliant/best/good/inaccuracy/mistake/blunder)

**3. Gera√ß√£o Autom√°tica de Puzzles** üéÆ
- Criar puzzles dos pr√≥prios erros detectados
- Sistema de pontua√ß√£o e feedback
- Armazenamento de puzzles para treino futuro
- Spaced repetition baseado em performance

## üìä Status Atual do Projeto

### ‚úÖ Sistema Completo de An√°lise e Treinamento:
- **Stockfish 17 integrado** - An√°lise profunda de posi√ß√µes (depth 18)
- **Analisador de Partidas** - Detecta blunders, mistakes e inaccuracies
- **Gerador de Puzzles** - Cria exerc√≠cios dos pr√≥prios erros
- **Puzzle Trainer** - Interface interativa com feedback visual
- **Sistema de Pontua√ß√£o** - Streak, estat√≠sticas e progresso
- **Persist√™ncia Completa** - Todos os dados salvos localmente

### üéØ Funcionalidades Principais:
- **An√°lise PGN** com classifica√ß√£o de movimentos (6 categorias)
- **ACPL** (Average Centipawn Loss) por cor
- **Detec√ß√£o autom√°tica** de blunders (>300 centipawns)
- **Feedback visual** instant√¢neo (verde/vermelho)
- **Timer de sess√£o** e contador de streak
- **Estat√≠sticas globais** persistentes

### üìà Pr√≥ximas Implementa√ß√µes:
- **Integra√ß√£o Chess.com API** para importar partidas
- **Sistema de spaced repetition** para otimizar aprendizado
- **Dashboard avan√ßado** com gr√°ficos e insights
- **Modo multiplayer** para desafios entre usu√°rios

## üöÄ ROADMAP - Sistema de An√°lise e Treinamento

### **FASE 1: Integra√ß√£o do Stockfish** ‚úÖ **[CONCLU√çDA]**
**Objetivo**: Ter o engine funcionando e analisando posi√ß√µes

- ‚úÖ Stockfish WASM configurado em `/public`
- ‚úÖ `StockfishService.ts` com singleton pattern
- ‚úÖ Comunica√ß√£o UCI via Web Workers
- ‚úÖ Hook `useStockfish` para componentes
- ‚úÖ An√°lise b√°sica de posi√ß√µes testada

### **FASE 2: Analisador de Partidas** ‚úÖ **[CONCLU√çDA]**
**Objetivo**: Analisar PGN e detectar erros automaticamente

- ‚úÖ `GameAnalyzer` component implementado
- ‚úÖ Parser de PGN com chess.js
- ‚úÖ An√°lise lance a lance com classifica√ß√£o
- ‚úÖ C√°lculo de ACPL (Average Centipawn Loss)
- ‚úÖ Interface com estat√≠sticas detalhadas

### **FASE 3: Gera√ß√£o de Puzzles** ‚úÖ **[CONCLU√çDA]**
**Objetivo**: Criar puzzles dos erros detectados

- ‚úÖ Detec√ß√£o de blunders (>300 centipawns loss)
- ‚úÖ Estrutura de puzzle com solu√ß√£o
- ‚úÖ Salvamento no localStorage
- ‚úÖ PuzzleService para gerenciamento
- ‚úÖ Sistema de UUID √∫nico por puzzle

### **FASE 4: Puzzle Trainer** ‚úÖ **[CONCLU√çDA]**
**Objetivo**: Interface para resolver puzzles

- ‚úÖ Componente `PuzzleTrainer` completo
- ‚úÖ Feedback visual (verde/vermelho)
- ‚úÖ Contador de acertos/erros e streak
- ‚úÖ Timer com formata√ß√£o mm:ss
- ‚úÖ Estat√≠sticas globais em tempo real

### **FASE 5: Integra√ß√£o Chess.com** üåê [3-4 dias]
**Objetivo**: Importar partidas automaticamente

- [ ] Integrar API p√∫blica do Chess.com
- [ ] Buscar partidas por username
- [ ] Filtrar partidas recentes
- [ ] An√°lise em batch de m√∫ltiplas partidas
- [ ] Gerar relat√≥rio consolidado

### **FASE 6: Sistema de Repeti√ß√£o Espa√ßada** üìà [4-5 dias]
**Objetivo**: Otimizar aprendizado com algoritmo SM-2

- [ ] Implementar algoritmo de repeti√ß√£o espa√ßada
- [ ] Tracking de performance por puzzle
- [ ] Calend√°rio de revis√£o
- [ ] Notifica√ß√µes de puzzles para revisar
- [ ] Ajuste de dificuldade din√¢mico

### **FASE 7: Dashboard e Estat√≠sticas** üìä [3-4 dias]
**Objetivo**: Visualizar progresso e insights

- [ ] Gr√°ficos de evolu√ß√£o temporal
- [ ] Heatmap de tipos de erro
- [ ] Estat√≠sticas por abertura
- [ ] Compara√ß√£o antes/depois
- [ ] Exportar relat√≥rios PDF

## üõ†Ô∏è Stack Tecnol√≥gico

[![React](https://img.shields.io/badge/React-18.3.1-61dafb)](https://react.dev)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.6.2-3178c6)](https://www.typescriptlang.org)
[![Vite](https://img.shields.io/badge/Vite-5.4.10-646cff)](https://vitejs.dev)
[![Chess.js](https://img.shields.io/badge/Chess.js-1.0.0--beta.8-green)](https://github.com/jhlywa/chess.js)

### Bibliotecas de Xadrez
- **chess.js**: Valida√ß√£o de movimentos e regras
- **react-chessboard**: Tabuleiro interativo
- **Stockfish WASM**: Engine de an√°lise (a ser integrado)

## üöÄ Como Usar o Sistema Completo

### 1Ô∏è‚É£ **Setup R√°pido** (Sistema j√° configurado!)
```bash
# Clone e execute
git clone https://github.com/frederico-kluser/opening-training.git
cd opening-training
npm install
npm run dev
```

### 2Ô∏è‚É£ **Fluxo de Uso Completo**

#### **Passo 1: Analisar uma Partida**
1. Acesse http://localhost:5173
2. Clique em **"Analisar Partidas"** (bot√£o azul)
3. Cole um PGN ou use **"Carregar Exemplo"**
4. Clique **"Analisar Partida"**
5. Veja os blunders detectados e estat√≠sticas

#### **Passo 2: Treinar com Puzzles**
1. Clique em **"Treinar Puzzles"** (bot√£o prim√°rio)
2. Resolva os puzzles gerados dos seus erros
3. Veja o feedback visual instant√¢neo:
   - ‚úÖ Verde = Movimento correto
   - ‚ùå Vermelho = Movimento incorreto
4. Acompanhe seu streak e estat√≠sticas

### 3Ô∏è‚É£ **Recursos Dispon√≠veis**

| Feature | Status | Como Acessar |
|---------|--------|-------------|
| An√°lise de Partidas | ‚úÖ Completo | Bot√£o "Analisar Partidas" |
| Detec√ß√£o de Erros | ‚úÖ Completo | Autom√°tico na an√°lise |
| Gera√ß√£o de Puzzles | ‚úÖ Completo | Autom√°tico ao detectar blunders |
| Puzzle Trainer | ‚úÖ Completo | Bot√£o "Treinar Puzzles" |
| Estat√≠sticas | ‚úÖ Completo | Vis√≠vel no Puzzle Trainer |
| Teste Stockfish | ‚úÖ Completo | Bot√£o "Testar Stockfish" |

## üíª C√≥digo de Exemplo - StockfishService.ts

```typescript
// src/services/StockfishService.ts
import EventEmitter from 'events';

interface StockfishAnalysis {
  bestMove: string;
  evaluation: number; // em centipawns
  depth: number;
  pv: string[]; // principal variation
}

class StockfishService extends EventEmitter {
  private worker: Worker | null = null;
  private isReady = false;
  private analysisCallbacks = new Map<string, (result: StockfishAnalysis) => void>();

  constructor() {
    super();
    this.initEngine();
  }

  private initEngine() {
    try {
      this.worker = new Worker('/stockfish.wasm.js');

      this.worker.onmessage = (e) => {
        const message = e.data;

        // Engine ready
        if (message === 'readyok') {
          this.isReady = true;
          this.emit('ready');
        }

        // Best move found
        if (message.startsWith('bestmove')) {
          const parts = message.split(' ');
          const bestMove = parts[1];
          const fen = this.getCurrentAnalysisFen();

          if (fen && this.analysisCallbacks.has(fen)) {
            const callback = this.analysisCallbacks.get(fen)!;
            callback({
              bestMove,
              evaluation: this.lastEvaluation || 0,
              depth: this.lastDepth || 0,
              pv: this.lastPV || []
            });
            this.analysisCallbacks.delete(fen);
          }
        }

        // Evaluation info
        if (message.startsWith('info')) {
          this.parseInfo(message);
        }
      };

      // Initialize UCI
      this.send('uci');
      this.send('isready');

    } catch (error) {
      console.error('Failed to initialize Stockfish:', error);
    }
  }

  private lastEvaluation = 0;
  private lastDepth = 0;
  private lastPV: string[] = [];
  private currentFen = '';

  private getCurrentAnalysisFen() {
    return this.currentFen;
  }

  private parseInfo(message: string) {
    // Parse depth
    const depthMatch = message.match(/depth (\d+)/);
    if (depthMatch) {
      this.lastDepth = parseInt(depthMatch[1]);
    }

    // Parse evaluation
    const cpMatch = message.match(/cp (-?\d+)/);
    if (cpMatch) {
      this.lastEvaluation = parseInt(cpMatch[1]);
    }

    // Parse mate
    const mateMatch = message.match(/mate (-?\d+)/);
    if (mateMatch) {
      const mateIn = parseInt(mateMatch[1]);
      this.lastEvaluation = mateIn > 0 ? 100000 - mateIn : -100000 + mateIn;
    }

    // Parse PV
    const pvMatch = message.match(/pv (.+)/);
    if (pvMatch) {
      this.lastPV = pvMatch[1].split(' ');
    }
  }

  private send(command: string) {
    if (this.worker) {
      this.worker.postMessage(command);
    }
  }

  async analyze(fen: string, depth: number = 15): Promise<StockfishAnalysis> {
    return new Promise((resolve) => {
      this.currentFen = fen;
      this.analysisCallbacks.set(fen, resolve);

      this.send(`position fen ${fen}`);
      this.send(`go depth ${depth}`);

      // Timeout after 10 seconds
      setTimeout(() => {
        if (this.analysisCallbacks.has(fen)) {
          this.analysisCallbacks.delete(fen);
          resolve({
            bestMove: '',
            evaluation: 0,
            depth: 0,
            pv: []
          });
        }
      }, 10000);
    });
  }

  setSkillLevel(level: number) {
    // 0-20, where 0 is weakest
    this.send(`setoption name Skill Level value ${level}`);
  }

  stop() {
    this.send('stop');
  }

  quit() {
    this.send('quit');
    if (this.worker) {
      this.worker.terminate();
      this.worker = null;
    }
  }
}

// Singleton instance
let stockfishInstance: StockfishService | null = null;

export const getStockfish = (): StockfishService => {
  if (!stockfishInstance) {
    stockfishInstance = new StockfishService();
  }
  return stockfishInstance;
};
```

## üèóÔ∏è Arquitetura do Projeto

```
src/
‚îú‚îÄ‚îÄ components/        # Componentes React reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ ChessGame/    # Tabuleiro interativo
‚îÇ   ‚îú‚îÄ‚îÄ Download/     # Exporta√ß√£o JSON
‚îÇ   ‚îú‚îÄ‚îÄ Gap/          # Espa√ßamento
‚îÇ   ‚îî‚îÄ‚îÄ Upload/       # Importa√ß√£o JSON
‚îú‚îÄ‚îÄ Pages/
‚îÇ   ‚îú‚îÄ‚îÄ Computer/     # ‚ö†Ô∏è Duplicado (precisa refatorar)
‚îÇ   ‚îî‚îÄ‚îÄ Register/     # Cadastro de variantes
‚îú‚îÄ‚îÄ stockfish/
‚îÇ   ‚îî‚îÄ‚îÄ engine.ts     # Classe Engine (n√£o utilizada ainda)
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ TypeStorage.ts # Schema de dados
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ isValidTypeStorage.ts
‚îú‚îÄ‚îÄ App.tsx           # Roteamento principal
‚îî‚îÄ‚îÄ main.tsx          # Entry point
```

## üì¶ Estrutura de Dados

### TypeStorage - Formato do Repert√≥rio
```typescript
interface TypeStorage {
  [abertura: string]: {
    [fen: string]: {
      prevFen: string;      // Posi√ß√£o anterior
      comment: string;      // Anota√ß√µes do usu√°rio
      nextFen: string[];    // Pr√≥ximas variantes
    }
  }
}
```

### Exemplo de dados reais:
```json
{
  "Caro-Kann": {
    "rnbqkbnr/pp1ppppp/2p5/8/4P3/8/PPPP1PPP/RNBQKBNR w KQkq - 0 2": {
      "prevFen": "posi√ß√£o_anterior",
      "comment": "Defesa s√≥lida contra e4",
      "nextFen": ["pr√≥xima_posi√ß√£o_1", "pr√≥xima_posi√ß√£o_2"]
    }
  }
}
```

## üéØ Pr√≥ximos Passos Imediatos

### DIA 1: Setup Stockfish
```bash
# Manh√£: Baixar e configurar
cd public && wget https://github.com/nmrugg/stockfish.js/raw/master/src/stockfish.wasm.js
npm install events uuid

# Tarde: Implementar StockfishService
# Copiar c√≥digo fornecido acima
# Testar an√°lise b√°sica
```

### DIA 2: GameAnalyzer Component
```bash
# Criar componente com c√≥digo fornecido
# Adicionar rota no App.tsx
# Testar com PGN de exemplo
```

### DIA 3: PuzzleTrainer
```bash
# Implementar interface de puzzles
# Sistema de feedback visual
# Salvar progresso
```

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Por favor:

1. Fork o projeto
2. Crie uma feature branch (`git checkout -b feature/NovaFuncionalidade`)
3. Commit suas mudan√ßas (`git commit -m 'Add: nova funcionalidade'`)
4. Push para a branch (`git push origin feature/NovaFuncionalidade`)
5. Abra um Pull Request

## üìÑ Licen√ßa

MIT License

---

**√öltima atualiza√ß√£o**: 03/01/2025